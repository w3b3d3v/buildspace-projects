üìí Lendo a blockchain a partir do nosso site
-----------------------------------------------

Impressionante. Conseguimos.

‚úÖ Deployamos nosso site.
‚úÖ Deployamos nosso contrato.
‚úÖ Conectamos nossa carteira.

‚åõÔ∏è Agora precisamos chamar nosso contrato a partir do nosso site usando as credenciais da Metamask √†s quais temos acesso agora!

Ent√£o, nosso contrato inteligente tem essa fun√ß√£o que recupera o n√∫mero total de tchauzinhos.

```solidity
  function getTotalWaves() public view returns (uint256) {
      console.log("Temos um total de %d tchauzinhos!", totalWaves);
      return totalWaves;
  }
```

Vamos chamar esta fun√ß√£o do nosso site :).

A partir de agora n√£o vou mais colocar o c√≥digo inteiro para voc√™ copiar e colar, isso vai exigir que voc√™ tenha aten√ß√£o e entenda onde o peda√ßo de c√≥digo deve entrar. Caso voc√™ coloque o c√≥digo no lugar errado, vai receber erro de sintaxe ou erro de execu√ß√£o. Se isso acontecer lembre-se de usar os canais de ajuda no nosso servidor do Discord.

V√° em frente e escreva esta fun√ß√£o logo abaixo da nossa fun√ß√£o `connectWallet()`. Perceba que caso o c√≥digo j√° tenha uma fun√ß√£o `wave` declarada, voc√™ vai receber um erro `/home/runner/projeto-tchauzinho/src/App.jsx: Identifier 'wave' has already been declared`. E neste caso voc√™ precisa substituir a fun√ß√£o `wave` definida anteriormente.

```javascript
const wave = async () => {
    try {
      const { ethereum } = window;

      if (ethereum) {
        const provider = new ethers.providers.Web3Provider(ethereum);
        const signer = provider.getSigner();
        const wavePortalContract = new ethers.Contract(contractAddress, contractABI, signer);

        let count = await wavePortalContract.getTotalWaves();
        console.log("Recuperado o n√∫mero de tchauzinhos...", count.toNumber());
      } else {
        console.log("Objeto Ethereum n√£o encontrado!");
      }
    } catch (error) {
      console.log(error)
    }
}
```

Explica√ß√£o r√°pida aqui:

```javascript
const provider = new ethers.providers.Web3Provider(ethereum);
const signer = provider.getSigner();
```

`ethers` √© uma biblioteca que ajuda nosso frontend a falar com nosso contrato. Certifique-se de import√°-lo no topo usando `import { ethers } from "ethers";`.

Um "Provedor" √© o que usamos para conversar com os n√≥s Ethereum. Lembra como est√°vamos usando o Alchemy para o **deploy**? Bem, neste caso, usamos os n√≥s que a Metamask fornece em segundo plano para enviar/receber dados do nosso contrato.

[Aqui est√°](https://docs.ethers.io/v5/api/signer/#signers) um link explicando o que √© um signat√°rio na linha 2.

Conecte esta fun√ß√£o ao nosso bot√£o `Mandar Tchauzinho` atualizando a prop `onClick` de `null` para `wave`:

```html
<button className="waveButton" onClick={wave}>
    Mandar Tchauzinho üåü
</button>
```

Impressionante.

Ent√£o, agora quando voc√™ clica no bot√£o, o c√≥digo **quebra** üòü. Em nosso console do Replit, aparecer√° a mensagem de erro `ReferenceError: contractAddress is not defined`

![](https://i.imgur.com/LGBalIt.png)

Precisamos dessas duas vari√°veis: `contractAddress` e `contractABI` !!

Ent√£o, o endere√ßo do contrato voc√™ tem -- certo? Lembra quando voc√™ fez o deploy do seu contrato e eu disse para voc√™ salvar o endere√ßo? √â isso que est√° pedindo!

Mas, o que √© um ABI? Muito antes eu mencionei como quando voc√™ compila um contrato, ele cria um monte de arquivos para voc√™ em `artifacts`. Um ABI √© um desses arquivos.

üè† Configurando o endere√ßo do seu contrato
-----------------------------

Lembra quando voc√™ implantou seu contrato no Goerli Testnet (√©pico, por sinal)? A sa√≠da dessa implanta√ß√£o incluiu seu endere√ßo de contrato inteligente, que deve ser algo assim:

```
Deploying contracts with the account: 0xF79A3bb8d5b93686c4068E2A97eAeC5fE4843E7D
Account balance: 3198297774605223721
WavePortal address: 0xd5f08a0ae197482FA808cE84E00E97d940dBD26E
```

Voc√™ precisa ter acesso a ele em seu aplicativo React. √â t√£o f√°cil quanto criar uma nova propriedade em seu arquivo `App.js` chamada `contractAddress` e definir seu valor para o `WavePortal address` que √© impresso em seu console. O in√≠cio do seu c√≥digo ficar√° como este aqui:

```javascript
import React, { useEffect, useState } from "react";
import { ethers } from "ethers";
import "./App.css";

const App = () => {
  const [currentAccount, setCurrentAccount] = useState("");
  /**
   * Cria uma vari√°vel para guardar o endere√ßo do contrato ap√≥s o deploy!
   */
  const contractAddress = "0xF2482AEDB6bfF7Cc73772fCBCeAA9157ff00c287";
```

Substitua o conte√∫do da constante `contractAddress` pelo valor do seu contrato.

üõ† Obtendo o conte√∫do do arquivo ABI
---------------------------
**Prefere me ver passar por isso?**

Confira este [v√≠deo onde explico como fazer](https://www.loom.com/share/53de0a270060417e94aae5032764afd1)

Olhe para voc√™, j√° est√° no meio do caminho! Vamos voltar para nossa pasta do contrato inteligente.

Quando voc√™ compila seu contrato inteligente, o compilador gera v√°rios arquivos necess√°rios que permitem que voc√™ interaja com o contrato. Voc√™ pode encontrar esses arquivos na pasta `artifacts` localizada na raiz do seu projeto Solidity.

O arquivo ABI √© algo que nosso aplicativo web precisa para saber como se comunicar com nosso contrato. [Leia mais sobre o arquivo ABI](https://docs.soliditylang.org/en/v0.5.3/abi-spec.html).

O conte√∫do do arquivo ABI pode ser encontrado em um arquivo JSON em seu projeto Hardhat:

`artifacts/contracts/WavePortal.sol/WavePortal.json`

Ent√£o, a quest√£o √© como colocamos esse arquivo JSON em nosso frontend? Para este projeto vamos fazer o bom e velho copia e cola, "Control + C, Control + V"!

Copie para a √°rea de trabalho (CRTL + C) o conte√∫do do seu `WavePortal.json` e depois v√° para o seu aplicativo web no Replit. Voc√™ vai criar uma nova pasta chamada `utils` em `src`. Em `utils` crie um arquivo chamado `WavePortal.json`. Assim, o caminho completo ficar√° assim:

`src/utils/WavePortal.json`

Cole todo o arquivo JSON ali mesmo!

Agora que voc√™ tem seu arquivo com todo o conte√∫do da ABI pronto, √© hora de import√°-lo para o arquivo `App.js` e criar uma refer√™ncia a ele. Logo abaixo de onde voc√™ importou `App.css` v√° em frente e importe seu arquivo JSON e crie sua refer√™ncia para o conte√∫do ABI:


```javascript
import React, { useEffect, useState } from "react";
import { ethers } from "ethers";
import "./App.css";
import abi from "./utils/WavePortal.json";

const App = () => {
  const [currentAccount, setCurrentAccount] = useState("");

  const contractAddress = "0xF2482AEDB6bfF7Cc73772fCBCeAA9157ff00c287";
  /**
   * Cria uma vari√°vel para referenciar o conte√∫do ABI!
   */
  const contractABI = abi.abi;
```
Vamos dar uma olhada onde voc√™ est√° usando o conte√∫do ABI:

```javascript
const wave = async () => {
    try {
      const { ethereum } = window;

      if (ethereum) {
        const provider = new ethers.providers.Web3Provider(ethereum);
        const signer = provider.getSigner();

        /*
        * Voc√™ est√° usando o contractABI aqui
        */
        const wavePortalContract = new ethers.Contract(contractAddress, contractABI, signer);

        let count = await wavePortalContract.getTotalWaves();
        console.log("Recuperado o n√∫mero de tchauzinhos...", count.toNumber());
      } else {
        console.log("Objeto Ethereum n√£o encontrado!");
      }
    } catch (error) {
      console.log(error)
    }
  }
  ```

Depois de adicionar esse arquivo e clicar no bot√£o "Mandar Tchauzinho" -- **voc√™ estar√° lendo oficialmente os dados do seu contrato na blockchain por meio do seu cliente web**.

üìù Escrevendo dados
---------------

O c√≥digo para gravar dados em nosso contrato n√£o √© muito diferente de ler dados. A principal diferen√ßa √© que quando queremos escrever novos dados em nosso contrato, precisamos notificar os mineradores para que a transa√ß√£o possa ser minerada. Quando lemos dados, n√£o precisamos fazer isso. As leituras s√£o "gratuitas" porque tudo o que estamos fazendo √© ler da blockchain, **n√£o a estamos alterando. **

Aqui est√° o c√≥digo para mandar um tchauzinho:

```javascript
const wave = async () => {
    try {
      const { ethereum } = window;

      if (ethereum) {
        const provider = new ethers.providers.Web3Provider(ethereum);
        const signer = provider.getSigner();
        const wavePortalContract = new ethers.Contract(contractAddress, contractABI, signer);

        let count = await wavePortalContract.getTotalWaves();
        console.log("Recuperado o n√∫mero de tchauzinhos...", count.toNumber());

        /*
        * Executar o tchauzinho a partir do contrato inteligente
        */
        const waveTxn = await wavePortalContract.wave();
        console.log("Minerando...", waveTxn.hash);

        await waveTxn.wait();
        console.log("Minerado -- ", waveTxn.hash);

        count = await wavePortalContract.getTotalWaves();
        console.log("Total de tchauzinhos recuperado...", count.toNumber());
      } else {
        console.log("Objeto Ethereum n√£o encontrado!");
      }
    } catch (error) {
      console.log(error)
    }
  }
```

Bem simples, n√©?

O que √© incr√≠vel aqui √© que, enquanto a transa√ß√£o est√° sendo minerada, voc√™ pode imprimir o hash da transa√ß√£o, copiar/colar no [Etherscan](https://goerli.etherscan.io/) e v√™-lo sendo processado em tempo real.

Quando executarmos isso, voc√™ ver√° que a contagem total de tchauzinhos √© aumentada em 1. Voc√™ tamb√©m ver√° que a Metamask aparece e nos pede para pagar "gas" que pagamos usando nosso $ falso. H√° um √≥timo [artigo sobre como funciona o gas](https://ethereum.org/en/developers/docs/gas/). Tente descobrir o que √© o **gas** :)

üéâ Sucesso
----------

**BOAAA :)**

Coisas realmente boas. Agora temos um cliente real que pode ler e gravar dados na blockchain. A partir daqui, voc√™ pode fazer o que quiser. Voc√™ j√° sabe o b√°sico. Voc√™ pode construir uma vers√£o descentralizada do Twitter. Voc√™ pode criar uma maneira para as pessoas postarem seus memes favoritos e permitir que as pessoas "pontuem" as pessoas que postarem os melhores memes com ETH. Voc√™ pode construir um sistema de vota√ß√£o descentralizado que um pa√≠s pode usar para votar em um pol√≠tico onde tudo √© aberto e claro.

As possibilidades s√£o infinitas.

üö® Antes de clicar em "Pr√≥xima li√ß√£o"
--------------------------------------------

*Nota: se voc√™ n√£o fizer isso, Daniel ficar√° muito triste :(.*

Personalize um pouco seu site para mostrar o n√∫mero total de tchauzinhos. Talvez mostrar uma barra de carregamento enquanto o tchauzinho est√° sendo minerada, o que voc√™ quiser. Fa√ßa algo um pouco diferente!

Quando sentir que est√° pronto, compartilhe o link do seu site conosco no canal #progresso para que possamos conectar nossas carteiras e dar tchauzinho para voc√™ :).

üéÅ Encerramento
--------------------

Voc√™ est√° a caminho de conquistar a web descentralizada. IMPRESSIONANTE. D√™ uma olhada em todo o c√≥digo que voc√™ escreveu nesta se√ß√£o visitando [este link](https://gist.github.com/danicuki/882259a049077bc8c8d228405b6c8c12) para ter certeza de que est√° no caminho certo com seu c√≥digo!
