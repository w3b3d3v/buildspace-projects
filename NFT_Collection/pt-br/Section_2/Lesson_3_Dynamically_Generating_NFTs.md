üî§ Gerando randomicamente palavras em uma imagem.
------------------

Bacana ‚Äî n√≥s criamos um contrato que agora cria NFTs dentro da rede (on-chain). Mas ainda √© sempre o mesmo NFT argh !!! Vamos torn√°-lo din√¢mico. 

**Eu escrevi esse c√≥digo [aqui](https://gist.github.com/farzaa/b788ba3a8dbaf6f1ef9af57eefa63c27) que ir√° gerar um SVG com uma combina√ß√£o de tr√™s palavras aleat√≥rias.**

Eu acho que essa seria a melhor maneira para as pessoas olharem todo o c√≥digo de uma vez e entender como ele est√° funcionando.

Eu tamb√©m escrevi um coment√°rio acima da maioria das linhas que adicionei/alterei! Quando voc√™ olhar para este c√≥digo, tente escrev√™-lo voc√™ mesmo. Pesquise no Google as fun√ß√µes que voc√™ n√£o entende!

Eu quero fazer algumas observa√ß√µes sobre algumas dessas linhas.

üìù Escolha as suas pr√≥prias palavras.
------------------

```solidity
string[] firstWords = ["YOUR_WORD", "YOUR_WORD", "YOUR_WORD", "YOUR_WORD", "YOUR_WORD", "YOUR_WORD"];
string[] secondWords = ["YOUR_WORD", "YOUR_WORD", "YOUR_WORD", "YOUR_WORD", "YOUR_WORD", "YOUR_WORD"];
string[] thirdWords = ["YOUR_WORD", "YOUR_WORD", "YOUR_WORD", "YOUR_WORD", "YOUR_WORD", "YOUR_WORD"];
```

Estas s√£o nossas palavras aleat√≥rias!! Por favor, divirta-se com isso. Certifique-se de que cada palavra seja √∫nica e sem espa√ßos!

Quanto mais engra√ßadas as palavras, melhor ser√° rs. Eu gostei de fazer de cada array um determinado tema. Por exemplo, `firstWords` pode ser o primeiro nome de seus personagens favoritos de anime. Ent√£o, `secondWords` pode ser um alimento de que voc√™ goste. E `thirdWords` podem ser nomes de animais aleat√≥rios. Divirta-se com isso!!! Deixe com a sua cara

Aqui est√£o alguns dos meus. Eu gosto que a primeira linha tenha palavras que parecem "descrever" algo!

![](https://i.imgur.com/ADawgrB.png)

Talvez voc√™ queira gerar um nome de banda aleat√≥rio. Talvez voc√™ queira gerar nomes de personagens aleat√≥rios para suas sess√µes de Dungeons and Dragons. Fa√ßa o que voc√™ quiser. Talvez voc√™ n√£o d√™ a m√≠nima para combina√ß√µes de tr√™s palavras e s√≥ queira fazer SVGs de pinguins de pixel art. V√° em frente. Fa√ßa o que voc√™ quiser :).

Observa√ß√£o: Eu comendo entre 15-20 palavras por array. Notei que cerca de 10 geralmente n√£o √© aleat√≥rio o suficiente.

ü•¥ N√∫meros aleat√≥rios.
------------------

```solidity
function pickRandomFirstWord
```

Esta fun√ß√£o parece meio descoladona, n√©? Vamos falar sobre como estamos escolhendo aleatoriamente as coisas dos arrays

Ent√£o, gerar um n√∫mero aleat√≥rio em contratos inteligentes √© amplamente conhecido como um **problema dif√≠cil**.

Por qu√™? Bem, pense em como um n√∫mero aleat√≥rio √© gerado normalmente. Quando voc√™ gera um n√∫mero aleat√≥rio normalmente em um programa, **pegar√° v√°rios n√∫meros diferentes de seu computador como uma fonte de aleatoriedade** como: a velocidade das ventoinhas, a temperatura da CPU, o n√∫mero de vezes que voc√™ pressionou "L" √†s 15:52 desde que comprou o computador, a velocidade da sua internet e v√°rios outros vari√°veis que s√£o dif√≠ceis de controlar. Ele pega **todos** esses n√∫meros que s√£o "aleat√≥rios" e os coloca juntos em um algoritmo que gera um n√∫mero que parece ser a melhor tentativa de um n√∫mero verdadeiramente "aleat√≥rio". Fez sentido?

No blockchain, n√£o h√° **quase nenhuma fonte de aleatoriedade**. √â determinista e tudo o que o contrato v√™, o p√∫blico v√™. Por causa disso, algu√©m poderia enganar o sistema apenas olhando para o smart contract, vendo em que vari√°vel ele se baseia para aleatoriedade, e ent√£o a pessoa poderia manipul√°-lo, se quisesse.

```solidity
random(string(abi.encodePacked("FIRST_WORD", Strings.toString(tokenId))));
```

O que isso est√° fazendo √© pegar duas coisas: a string atual `FIRST_WORD` e uma vers√£o stringificada do` tokenId`. Eu combino essas duas strings usando `abi.encodePacked` e ent√£o essa string combinada √© o que eu uso como fonte de aleatoriedade.

**Isso n√£o √© aleatoriedade verdadeira.** Mas √© o melhor que temos por agora!

Existem outras maneiras de gerar n√∫meros aleat√≥rios no blockchain (verifique o [Chainlink](https://docs.chain.link/docs/chainlink-vrf/)), mas o Solidity nativamente n√£o nos d√° nada confi√°vel porque n√£o pode! Todos as varaiveis que nosso contrato pode acessar s√£o p√∫blicas e nunca verdadeiramente aleat√≥rios.

Isso pode ser um pouco irritante para alguns aplicativos como o nosso aqui! Em qualquer caso, ningu√©m vai atacar nosso pequeno aplicativo, mas quero que voc√™ saiba de tudo isso quando estiver construindo um dApp que tem milh√µes de usu√°rios!

‚ú®  Criando o SVG dinamicamente.
------------------

Verifique a vari√°vel `string baseSvg` no contrato. Isso ta louco demais rs. Basicamente, a √∫nica parte do nosso SVG que muda √© o combo de tr√™s palavras, certo? Ent√£o o que fazemos √© criar uma vari√°vel `baseSvg` que podemos reutilizar continuamente conforme criamos novos NFTs.


Em seguida, reunimos tudo usando:

```
string memory finalSvg = string(abi.encodePacked(baseSvg, first, second, third, "</text></svg>"));
```
`</text></svg>` s√£o as tags de fechamento! Ent√£o, para `finalSvg`, estamos dizendo: "Ei - v√° combinar meu baseSVG, meu combo de tr√™s palavras que acabei de gerar e minhas tags de fechamento." √â isso a√≠ :)! Parece assustador, mas tudo o que estamos fazendo √© trabalhar com o c√≥digo SVG.

üòé Executando!
------------------------

Depois de escrever tudo, v√° em frente e execute-o usando `npx hardhat run scripts0/run.js`. Verifique a saida produzido por `console.log(finalSvg);`.

Isto √© oque aparece no meu terminal.

```plaintext
This is my NFT contract. Woah!
Contract deployed to: 0x5FbDB2315678afecb367f032d93F642f64180aa3
--------------------
<svg xmlns='http://www.w3.org/2000/svg' preserveAspectRatio='xMinYMin meet' viewBox='0 0 350 350'><style>.base { fill: white; font-family: serif; font-size: 24px; }</style><rect width='100%' height='100%' fill='black' /><text x='50%' y='50%' class='base' dominant-baseline='middle' text-anchor='middle'>SandwichSakuraNinja</text></svg>
--------------------
An NFT w/ ID 0 has been minted to 0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266
--------------------
<svg xmlns='http://www.w3.org/2000/svg' preserveAspectRatio='xMinYMin meet' viewBox='0 0 350 350'><style>.base { fill: white; font-family: serif; font-size: 24px; }</style><rect width='100%' height='100%' fill='black' /><text x='50%' y='50%' class='base' dominant-baseline='middle' text-anchor='middle'>GoatSasukeNinja</text></svg>
--------------------
An NFT w/ ID 1 has been minted to 0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266
```

Haha, isso √© um monte de coisas. V√° em frente e copie um dos SVGs que foi gerado em seu terminal e cole-o [aqui](https://www.svgviewer.dev/) para ver o que voc√™ obt√©m.

Voc√™ poder√° ver o SVG que foi gerado! Aqui est√° o meu:

![Untitled](https://i.imgur.com/uS8SXYu.png)

**TACALE PAU NESSE CARRINHO!!!!** Geramos isso aleatoriamente em nosso contrato! Se voc√™ pegar o outro SVG gerado perceber√° que ele √© diferente. Tudo est√° sendo gerado instantaneamente. YAY.

üë©‚Äçüíª Gerando os metadados dinamicamente.
------------------

Agora, precisamos definir os metadados JSON! Primeiro, precisamos de algumas fun√ß√µes auxiliares. Crie uma pasta chamada `libraries` em `contracts`. Em `libraries`, crie um arquivo chamado` Base64.sol` e copie e cole o c√≥digo [aqui](https://gist.github.com/farzaa/f13f5d9bda13af68cc96b54851345832) nele. Este arquivo tem algumas fun√ß√µes auxiliares criadas por outra pessoa para nos ajudar a converter nosso SVG e JSON para Base64 no Solidity.

Okay, agora atualize o nosso contrato.

**Mesma coisa, escrevi todo o c√≥digo e adicionei coment√°rios [aqui](https://gist.github.com/farzaa/dc45da3eb91a41913767f3eb4d7830f1).**

Sinta-se √† vontade para copiar e colar algumas dessas partes e entender como funciona depois de execut√°-lo :). √Äs vezes eu gosto de fazer isso porque posso ver o c√≥digo sendo executado e entender como funciona depois!!

Depois de executar o contrato, aqui est√° o que recebo do terminal:

```plaintext
Compilation finished successfully
This is my NFT contract. Woah!
Contract deployed to: 0x5FbDB2315678afecb367f032d93F642f64180aa3
--------------------
data:application/json;base64,eyJuYW1lIjogIlNhbmR3aWNoU2FrdXJhTmluamEiLCAiZGVzY3JpcHRpb24iOiAiQSBoaWdobHkgYWNjbGFpbWVkIGNvbGxlY3Rpb24gb2Ygc3F1YXJlcy4iLCAiaW1hZ2UiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBuYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNuSUhCeVpYTmxjblpsUVhOd1pXTjBVbUYwYVc4OUozaE5hVzVaVFdsdUlHMWxaWFFuSUhacFpYZENiM2c5SnpBZ01DQXpOVEFnTXpVd0p6NDhjM1I1YkdVK0xtSmhjMlVnZXlCbWFXeHNPaUIzYUdsMFpUc2dabTl1ZEMxbVlXMXBiSGs2SUhObGNtbG1PeUJtYjI1MExYTnBlbVU2SURJMGNIZzdJSDA4TDNOMGVXeGxQanh5WldOMElIZHBaSFJvUFNjeE1EQWxKeUJvWldsbmFIUTlKekV3TUNVbklHWnBiR3c5SjJKc1lXTnJKeUF2UGp4MFpYaDBJSGc5SnpVd0pTY2dlVDBuTlRBbEp5QmpiR0Z6Y3owblltRnpaU2NnWkc5dGFXNWhiblF0WW1GelpXeHBibVU5SjIxcFpHUnNaU2NnZEdWNGRDMWhibU5vYjNJOUoyMXBaR1JzWlNjK1UyRnVaSGRwWTJoVFlXdDFjbUZPYVc1cVlUd3ZkR1Y0ZEQ0OEwzTjJaejQ9In0=
--------------------
An NFT w/ ID 0 has been minted to 0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266
--------------------
data:application/json;base64,eyJuYW1lIjogIkdvYXRTYXN1a2VOaW5qYSIsICJkZXNjcmlwdGlvbiI6ICJBIGhpZ2hseSBhY2NsYWltZWQgY29sbGVjdGlvbiBvZiBzcXVhcmVzLiIsICJpbWFnZSI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MG5hSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY25JSEJ5WlhObGNuWmxRWE53WldOMFVtRjBhVzg5SjNoTmFXNVpUV2x1SUcxbFpYUW5JSFpwWlhkQ2IzZzlKekFnTUNBek5UQWdNelV3Sno0OGMzUjViR1UrTG1KaGMyVWdleUJtYVd4c09pQjNhR2wwWlRzZ1ptOXVkQzFtWVcxcGJIazZJSE5sY21sbU95Qm1iMjUwTFhOcGVtVTZJREkwY0hnN0lIMDhMM04wZVd4bFBqeHlaV04wSUhkcFpIUm9QU2N4TURBbEp5Qm9aV2xuYUhROUp6RXdNQ1VuSUdacGJHdzlKMkpzWVdOckp5QXZQangwWlhoMElIZzlKelV3SlNjZ2VUMG5OVEFsSnlCamJHRnpjejBuWW1GelpTY2daRzl0YVc1aGJuUXRZbUZ6Wld4cGJtVTlKMjFwWkdSc1pTY2dkR1Y0ZEMxaGJtTm9iM0k5SjIxcFpHUnNaU2MrUjI5aGRGTmhjM1ZyWlU1cGJtcGhQQzkwWlhoMFBqd3ZjM1puUGc9PSJ9
--------------------
An NFT w/ ID 1 has been minted to 0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266
```

ISSO √â √âPICO. 

NOS ACABAMOS DE GERAR DINAMICAMENTE UM NFT INTEIRO. DENTRO DA BLOCKCHAIN (ON-CHAIN). ESTE √â UM MOMENTO √âPICO. 

Se voc√™ pegar um dos blobs `data:application/json;base64` e jogar na barra de endere√ßo do navegador, ver√° todos os metadados JSON como antes. Exceto que agora tudo √© feito automaticamente em nosso contrato :).

üëÄ Como raios funciona o `finalTokenUri`?
------------------

Essa linha grande com `string memory json = Base64.encode` pode parecer um pouco confusa, mas, s√≥ parece confusa por causa de todas as aspas rs. Tudo o que estamos fazendo √© codificar em base64 os metadados JSON! Mas - est√° tudo **on-chain**. Ent√£o, todo esse JSON viver√° no pr√≥prio contrato.

N√≥s tambem adicionamos dinamicamente o `name` e o SVG codificado em base64!

Finalmente, temos este `finalTokenUri` onde colocamos tudo junto e fazemos:

```solidity
abi.encodePacked("data:application/json;base64,", json)
```

Tudo o que est√° acontecendo aqui √© que estamos juntando tudo e adicionando o nosso velho conhecido `data:application/json;base64,` que fizemos antes e depois acrescentamos o json codificado em base64!!


üõ† Debugando o conteudo de `finalTokenUri`
------------------------

Agora que voc√™ configurou o tokenURI, como sabemos se ele est√° realmente correto? Afinal, ele cont√©m todos os nossos dados para nosso NFT! Voc√™ pode usar uma ferramenta legal como - [NFT Preview](https://nftpreview.0xdev.codes/) para ver uma visualiza√ß√£o r√°pida da imagem e o conte√∫do do json sem deplpoar de novo e e de novo na testnet do opensea.

Para facilitar, voc√™ pode passar o c√≥digo `tokenURI` como um par√¢metro de consulta como este,

```solidity
string memory finalTokenUri = string(
    abi.encodePacked("data:application/json;base64,", json)
);
console.log("\n--------------------");
console.log(
    string(
        abi.encodePacked(
            "https://nftpreview.0xdev.codes/?code=",
            finalTokenUri
        )
    )
);
console.log("--------------------\n");
```
![image](https://i.imgur.com/CsBxROj.png)

üöÄ Deployando na Rinkeby
------------------
A parte mais legal √© que podemos apenas re-deployar sem alterar nosso script usando:

```bash
npx hardhat run scripts/deploy.js --network rinkeby
```

Assim que fizermos o redeploy, voc√™ poder√° ver seus NFTs em [https://testnets.opensea.io/](https://testnets.opensea.io/) assim que pesquisar o endere√ßo do contrato rec√©m deployado. Novamente, **n√£o clique o bot√£o enter**. O OpenSea √© estranho, ent√£o voc√™ precisa clicar na pr√≥pria cole√ß√£o quando ela aparecer.

OBSERVA√á√ÉO: Lembre-se de usar `https://rinkeby.rarible.com/token/INSIRA_O_ENDERE√áO_DE_CONTRATO_AQUI:INSIRA_O_TOKEN_ID_AQUI` se voc√™ estiver usando o Rarible.

Os contratos s√£o **permanentes**. Ent√£o, toda vez que voc√™ redeployar o nosso contrato na verdade, estamos criando uma cole√ß√£o totalmente nova.

Voc√™ deve conseguir ver a nova cole√ß√£o no OpenSea ou no Rarible :)!

ü§ñ Permitindo que os usu√°rios cunhem (Mint).
------------------

√âpico - agora podemos cunhar NFTs dinamicamente e temos esta fun√ß√£o `makeAnEpicNFT` que os usu√°rios podem chamar. Muito progresso foi feito!! Mas n√£o h√° como pessoas aleat√≥rias criarem NFTs :(.

Tudo o que precisamos √© um site que permita que os usu√°rios criem um NFT por conta pr√≥pria.


Ent√£o, vamos construir isso :)!

üö® Relat√≥rio de progresso.
------------------------

Se voc√™ tiver um, envie uma captura de tela em #progress de seu novo NFT gerado dinamicamente no OpenSea/Rarible em #progress :). Al√©m disso - se voc√™ ainda n√£o tweetou uma imagem de sua cole√ß√£o maravilhosa de NFT, agora √© a hora de faz√™-lo!! Lembre-se de marcar @_buildspace !!! Traremos o m√°ximo de pessoas poss√≠vel!